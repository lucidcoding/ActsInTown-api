package uk.co.luciditysoftware.actsintown.api.controllers;

import java.security.Key;
import java.security.NoSuchAlgorithmException;
import java.util.Base64;

import javax.crypto.KeyGenerator;
import javax.crypto.SecretKey;
import javax.crypto.spec.SecretKeySpec;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;

import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.impl.crypto.MacProvider;
import uk.co.luciditysoftware.actsintown.api.config.SecurityConfiguration;

@RestController
@RequestMapping("/token")
public class TokenController {
	@RequestMapping(value = "", method = RequestMethod.GET)
	@ResponseBody
	public String get()  {

		//http://stackoverflow.com/questions/5355466/converting-secret-key-into-a-string-and-vice-versa
		//Key key = MacProvider.generateKey();
		//String encodedKey = SecurityConfiguration.JWT_SIGNING_KEY;;
		//byte[] decodedKey = Base64.getDecoder().decode(encodedKey);
		byte[] decodedKey = SecurityConfiguration.JWT_SIGNING_KEY.getBytes();
		// rebuild key using SecretKeySpec
		SecretKey key = new SecretKeySpec(decodedKey, 0, decodedKey.length, "AES"); 
		
		String compactJws = Jwts.builder()
		  .setSubject("Joe")
		  .signWith(SignatureAlgorithm.HS512, key)
		  .compact();
		
		return compactJws;
	}
}
